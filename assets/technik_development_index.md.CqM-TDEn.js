import{_ as i,c as o,j as t,a,b as s,w as n,a3 as d,a2 as c,B as m,o as r,G as h}from"./chunks/framework.DAx0yoxq.js";const u="/Wahllokalsystem/keycloak/deleteRealmAction.png",k="/Wahllokalsystem/keycloak/createRealmTrigger.png",g="/Wahllokalsystem/keycloak/exampleOfKeycloakmigrationRun.png",B=JSON.parse('{"title":"Entwicklungsumgebung","description":"","frontmatter":{},"headers":[],"relativePath":"technik/development/index.md","filePath":"technik/development/index.md"}'),p={name:"technik/development/index.md"};function b(w,e,f,y,D,R){const l=m("Mermaid");return r(),o("div",null,[e[1]||(e[1]=t("h1",{id:"entwicklungsumgebung",tabindex:"-1"},[a("Entwicklungsumgebung "),t("a",{class:"header-anchor",href:"#entwicklungsumgebung","aria-label":'Permalink to "Entwicklungsumgebung"'},"​")],-1)),e[2]||(e[2]=t("h2",{id:"zusammenspiel-ide-mit-docker",tabindex:"-1"},[a("Zusammenspiel IDE mit Docker "),t("a",{class:"header-anchor",href:"#zusammenspiel-ide-mit-docker","aria-label":'Permalink to "Zusammenspiel IDE mit Docker"'},"​")],-1)),(r(),s(d,null,{default:n(()=>[h(l,{id:"mermaid-6",class:"mermaid my-class",graph:"flowchart%20LR%0A%20%20%20%20%0A%20%20%20%20subgraph%20Dev-PC%20%0A%20%20%20%20%20%20%20%20subgraph%20IDE%20%0A%20%20%20%20%20%20%20%20%20%20%20%20wlsService%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20subgraph%20Docker%20%0A%20%20%20%20%20%20%20%20%20%20%20%20keycloak%5BKeycloak%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20keycloakDB%5Bdb-postgres-keycloak%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20keycloakInit%5Binit-keycloak%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20oracleDB%5BOracle%20DB%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20wlsService%20---%7COAuth2%7C%20keycloak%0A%20%20%20%20%20%20%20%20wlsService%20---%3E%7Cpersisting%7CoracleDB%0A%0A%20%20%20%20%20%20%20%20keycloak--%3E%7Cpersisting%7C%20keycloakDB%0A%20%20%20%20%20%20%20%20keycloakInit--%3E%7Csetup%20of%7C%20keycloak%0A%20%20%20%20end%0A"})]),fallback:n(()=>e[0]||(e[0]=[a(" Loading... ")])),_:1})),e[3]||(e[3]=c('<h2 id="keycloak" tabindex="-1">Keycloak <a class="header-anchor" href="#keycloak" aria-label="Permalink to &quot;Keycloak&quot;">​</a></h2><h3 id="benutzer" tabindex="-1">Benutzer <a class="header-anchor" href="#benutzer" aria-label="Permalink to &quot;Benutzer&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Name</th><th>Passwort</th><th>Beschreibung</th></tr></thead><tbody><tr><td>keycloak_test</td><td>test</td><td>Ein Benutzer ohne weitere Rechte</td></tr><tr><td>wls_all</td><td>test</td><td>Ein Benutzer mit allen Rechten</td></tr><tr><td>wls_all_bwb</td><td>test</td><td>Ein Benutzer mit allen Rechten mit der WahlbezirksArt BWB (Briefwahl)</td></tr><tr><td>wls_all_uwb</td><td>test</td><td>Ein Benutzer mit allen Rechten mit der WahlbezirksArt UWB (Urnenwahl)</td></tr></tbody></table><h3 id="migration" tabindex="-1">Migration <a class="header-anchor" href="#migration" aria-label="Permalink to &quot;Migration&quot;">​</a></h3><p>Alle Konfigurationselemente, wie zum Beispiel User, Rollen und Client, werden automatisiert erstellt. Der Realm wird beim Start von Keycloak importiert. Alle weiteren Elemente werden durch den <code>init-keycloak</code>-Container erstellt.</p><p>Im Rahmen der Migration werden immer alle Elemente erstellt. Daher ist notwendig, dass zuvor alte Elemente gelöscht wurden. Somit ergeben sich folgende Schritte bei der Migration:</p><ul><li>alten Realm löschen</li><li>Realm anlegen</li><li>Migrieren von Client, Rolles und Usern</li></ul><h4 id="loschen-des-alten-realm" tabindex="-1">Löschen des alten Realm <a class="header-anchor" href="#loschen-des-alten-realm" aria-label="Permalink to &quot;Löschen des alten Realm&quot;">​</a></h4><p>Über die Weboberfläche kann der Realm gelöscht werden. Dazu ist der Realm <code>wls_realm</code> auszuwählen. Unter dem Menüpunkt <code>Realm settings</code> kann über die Action (Drop-Down im oberen rechter Bereich) <code>Delete</code> der Realm gelöscht werden.</p><p><img src="'+u+'" alt="Image with delete realm action"><br><em>Löschen des Realms über die Actions in den Realm Settings</em></p><h4 id="realm-anlegen" tabindex="-1">Realm anlegen <a class="header-anchor" href="#realm-anlegen" aria-label="Permalink to &quot;Realm anlegen&quot;">​</a></h4><p>Um den Client, die Rollen und die User im nächsten Schritt anlegen zu können muss der Realm wieder angelegt werden. Dies erfolgt über den Import der Realmsettings. Dazu gibt es zwei Varianten</p><p><strong>Variante 1 - Neustarten des Containers</strong></p><p>Beim Starten des Containers wird der Realm importiert.</p><p><strong>Variante 2 - Realm über Weboberfläche anlegen</strong></p><p>Über die Weboberfläche kann ein neuer Realm angelegt werden. In der darauffolgenden Ansicht wird über <code>browse</code> das Konfigurationsfile ausgewählt und abschließend nach dem Klick auf <code>Create</code> wird der Realm angelegt.</p><p>Die Datei <code>import-wls-realm.json</code> liegt im Pfad <code>stack/keycloak/import</code> des Projektes.</p><p><img src="'+k+'" alt="Image with create realm button"><br><em>Button zum Anlegen eines neues Realm im Dropdown der Realms</em></p><h4 id="ausfuhren-von-wls-init-keycloak" tabindex="-1">Ausführen von <code>wls-init-keycloak</code> <a class="header-anchor" href="#ausfuhren-von-wls-init-keycloak" aria-label="Permalink to &quot;Ausführen von `wls-init-keycloak`&quot;">​</a></h4><p>Die abschließende Migration des Clients, der User, Gruppen und Rollen erfolgt durch den Container <code>wls-init-keycloak</code>. Dazu den Container starten. Nach Abschluss der Migration beendet sich der Container.</p><p><img src="'+g+'" alt="Image log of a wls init keycloak container run"><br><em>Auszug aus dem Log einer erfolgreich durchgeführten Migration</em></p><h3 id="beispiel-requests" tabindex="-1">Beispiel-Requests <a class="header-anchor" href="#beispiel-requests" aria-label="Permalink to &quot;Beispiel-Requests&quot;">​</a></h3><p>Im Soap-UI-Projekt (<code>DockerTest-soapui-project</code>) und <code>docker.keycloak.http</code> sind Beispielrequests vorhanden. Es kann für den jeweiligen Nutzer ein Token geholt werden. Außerdem ist die Anfrage an den UserInfo-Endpoint hinterlegt.</p><h2 id="datenbank" tabindex="-1">Datenbank <a class="header-anchor" href="#datenbank" aria-label="Permalink to &quot;Datenbank&quot;">​</a></h2><p>Jeder Service bekommt einen eigenen Benutzer für die Datenbank. Die Zugriffs-URL ist für alle Services gleich: <code>jdbc:oracle:thin:@//localhost:1521/XEPDB1</code></p><p>Neben dem Standardbenutzer der auf alles zugreifen kann (siehe <code>docker-compose.yml</code>) müssen alle weiteren Benutzer über <code>stack/add-user-on-startup.sql</code> erstellt werden.</p><p>Dabei sollte auf folgendes Schema geachtet werden:</p><ul><li>Benutzername: &lt;Name des Services&gt;</li><li>Passwort: secret</li></ul>',28))])}const z=i(p,[["render",b]]);export{B as __pageData,z as default};
