package de.muenchen.oss.wahllokalsystem.rest;

import de.muenchen.oss.wahllokalsystem.service.BroadcastService;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.PostMapping;

/*
 * This file will be overwritten on every change of the model!
 * This file was automatically generated by GAIA.
 */
/**
 * This controller is responsible for mapping businessActions to REST-endpoints.
 */
@RestController
@RequestMapping(value = "/businessActions")
public class BroadcastController {

    private final String BROADCAST_PATH = "/broadcast";
    private final String MESSAGE_PATH = "/getMessage/{wahlbezirkID}";
    private final String MESSAGE_READ_PATH = "/messageRead/{nachrichtID}";

    @Autowired
    BroadcastService broadcastService;

    /**
     * This BusinessAction's purpose is: Bietet einen Endpunkt an, der eine Nachricht für alle Wahlbezirke(Wahllokale) bereitstellt.
     */
    @PostMapping(value = BROADCAST_PATH)
    public void broadcast(@RequestBody BroadcastMessageDTO body) {
        broadcastService.broadcast(body);
    }

    /**
     * This BusinessAction's purpose is: Endpunkt zum prüfen, ob eine Nachricht für dieses Wahllokal verfügbar ist
     * It returns one String.
     */
    @GetMapping(value = MESSAGE_PATH)
    public MessageDTO getMessage(@PathVariable("wahlbezirkID") String wahlbezirkID) {
        return broadcastService.getOldestMessage(wahlbezirkID);
    }

    /**
     * This BusinessAction's purpose is: Markiert die Nachricht mit der gegebenen ID als gelesen
     */
    @PostMapping(value = MESSAGE_READ_PATH) //TODO DeleteMapping wäre besser
    public void deleteMessage(@PathVariable("nachrichtID") String nachrichtID) {  //TODO Besser wäre 204
        broadcastService.deleteMessage(nachrichtID);
    }

}
